import{_ as s,c as a,o as n,Q as l}from"./chunks/framework.8adc4ca2.js";const p="/assets/1653816442941-1e0c3957-0f1c-4d17-821f-6880e7b8ea40.75d4de6e.png",o="/assets/image-20230413235112008.4db7b5b7.png",e="/assets/image-20230413235432195.5cb0ae82.png",t="/assets/image-20230414000210957.61c3d57d.png",c="/assets/image-20230414000304293.21e67a04.png",r="/assets/image-20230414001428137.114adcb0.png",i="/assets/image-20230414001544545.1f7b1263.png",y="/assets/image-20230414003739497.12a9e196.png",D="/assets/image-20230414002237284.ce31c883.png",C="/assets/image-20230414002720730.58de0efa.png",F="/assets/image-20230414003156164.087d5459.png",A="/assets/image-20230414003038880.783fefcb.png",d="/assets/image-20230414003257179.0570da2e.png",h="/assets/image-20230414003502085.ddcc99c8.png",v=JSON.parse('{"title":"部署实战","description":"","frontmatter":{"title":"部署实战","order":3},"headers":[],"relativePath":"pages/devops/deploy/example.md","lastUpdated":1681488216000}'),m={name:"pages/devops/deploy/example.md"},g=l(`<h1 id="部署实战" tabindex="-1">部署实战 <a class="header-anchor" href="#部署实战" aria-label="Permalink to &quot;部署实战&quot;">​</a></h1><h2 id="部署-nextjs-项目" tabindex="-1">部署 nextjs 项目 <a class="header-anchor" href="#部署-nextjs-项目" aria-label="Permalink to &quot;部署 nextjs 项目&quot;">​</a></h2><p>项目放置地址: <code>/data</code></p><p>nginx 配置文件：<code>/etc/nginx/conf.d/test_project_nginx.conf</code></p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> listen </span><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">8011</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> server_name </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12.12.12.12</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 需配置为对应服务器端口</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> index </span><span style="color:#A6ACCD;">index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip </span><span style="color:#A6ACCD;">           </span><span style="color:#89DDFF;"> on;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_min_length </span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_proxied </span><span style="color:#A6ACCD;">    expired no-cache no-store private auth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;"> gzip_types </span><span style="color:#A6ACCD;">      text/plain application/x-javascript text/html text/css application/xml application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/ </span><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_pass </span><span style="color:#A6ACCD;"> http://127.0.0.1:3011</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;"> proxy_set_header </span><span style="color:#A6ACCD;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><blockquote><p>注意：12.12.12.12 - 改为对应服务端口</p></blockquote><p>pm2 配置文件路径： <code>/etc/nginx/conf.d/ecosystem.config.js</code></p><p>参数说明</p><ul><li>name ： pm2 名称</li><li>script：命令</li><li>args：命令参数</li><li>cwd：项目根目录</li></ul><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">apps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test_project</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/next/dist/bin/next</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">start -p 3012</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">max_memory_restart</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1024M</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">cwd</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/data/test_project</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 根目录</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">instances</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">error_file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logs/error.log</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">out_file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logs/out.log</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">log_date_format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">YYYY-MM-DD HH:mm Z</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">watch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">ignore_watch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><blockquote><p>ecosystem.config.js 为固定名称</p></blockquote><p>启动方式 ： <code>pm2 start ecosystem.config.js</code></p><h3 id="相关链接" tabindex="-1">相关链接 <a class="header-anchor" href="#相关链接" aria-label="Permalink to &quot;相关链接&quot;">​</a></h3><p>pm2 官网：<a href="https://pm2.keymetrics.io/" target="_blank" rel="noreferrer">https://pm2.keymetrics.io/</a></p><h2 id="自动化部署-vitepress" tabindex="-1">自动化部署 vitepress <a class="header-anchor" href="#自动化部署-vitepress" aria-label="Permalink to &quot;自动化部署 vitepress&quot;">​</a></h2><h3 id="配置-repository-secrets" tabindex="-1">配置 Repository secrets <a class="header-anchor" href="#配置-repository-secrets" aria-label="Permalink to &quot;配置 Repository secrets&quot;">​</a></h3><p>port 端口默认 22 <img src="`+p+`" alt="image.png" style="zoom:80%;"></p><h3 id="配置-workflows" tabindex="-1">配置 workflows <a class="header-anchor" href="#配置-workflows" aria-label="Permalink to &quot;配置 workflows&quot;">​</a></h3><p><code>.github/workflows/main.yml</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#676E95;font-style:italic;"># This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tk-notes-ci/cd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">master</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#  pull_request:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#   branches: [master]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">strategy</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">matrix</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">node-version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">16.x</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># download source</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Checkout</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/checkout@master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># Install &amp; Build</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/setup-node@master</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">|</span></span>
<span class="line"><span style="color:#C3E88D;">          yarn install</span></span>
<span class="line"><span style="color:#C3E88D;">          yarn build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># copy dist</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Upload</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">appleboy/scp-action@master</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">host</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.HOST }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.USERNAME }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.PASSWORD }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.PORT }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">source</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./docs/.vitepress/dist/*</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/data/tk-notes</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">strip_components</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 去掉 3 层路径, /data/tk-notes/docs/.vitepress/dist/* =&gt; /data/tk-notes/*</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># run source</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;"># - name: Deploy</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#   uses: appleboy/ssh-action@master</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#   with:</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#     host: \${{ secrets.HOST }}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#     username: \${{ secrets.USERNAME }}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#     password: \${{ secrets.PASSWORD }}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#     port: \${{ secrets.PORT }}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#     script: |</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#       cd /data/tk-notes</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#       yarn install</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#       yarn build</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">#       pm2 start yarn --name tk-docs -- serve</span></span></code></pre></div><h3 id="相关链接-1" tabindex="-1">相关链接 <a class="header-anchor" href="#相关链接-1" aria-label="Permalink to &quot;相关链接&quot;">​</a></h3><p><a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noreferrer">GitHub Actions 入门教程</a></p><p><a href="https://github.com/marketplace/actions/scp-command-to-transfer-files" target="_blank" rel="noreferrer">appleboy/scp-action@master</a></p><h2 id="vitepress-部署到-github-pages" tabindex="-1">vitepress 部署到 Github Pages <a class="header-anchor" href="#vitepress-部署到-github-pages" aria-label="Permalink to &quot;vitepress 部署到 Github Pages&quot;">​</a></h2><blockquote><p>以下例子均以 <a href="https://github.com/Asplitline/wiki-template" target="_blank" rel="noreferrer">https://github.com/Asplitline/wiki-template</a> 为例</p></blockquote><h3 id="第一步-生成-token" tabindex="-1">第一步：生成 token <a class="header-anchor" href="#第一步-生成-token" aria-label="Permalink to &quot;第一步：生成 token&quot;">​</a></h3><p>生成 token，用于后面 git action 操作</p><p>步骤：<code>setting -&gt; Developer settings -&gt; Tokens (classic) -&gt; Generate new token -&gt; Generate new token (classic)</code>。</p><p><img src="`+o+'" alt="image-20230413235112008"></p><p>按顺序操作后，会进入生成 token 页面。</p><p>expiration：到期时间。怕麻烦直接选无期限（不建议）。</p><p>Select scopes：token 所具有权限。至少选择 <code>repo</code> 和 <code>workflow</code>，其他看情况。</p><img src="'+e+'" alt="image-20230413235432195" style="zoom:80%;"><h3 id="第二步-使用-token" tabindex="-1">第二步：使用 token <a class="header-anchor" href="#第二步-使用-token" aria-label="Permalink to &quot;第二步：使用 token&quot;">​</a></h3><p>生成后将 token 复制对应仓库（<code>wiki-template</code>）下面</p><p>步骤：<code>Settings -&gt; Actions -&gt; New repository secret</code></p><p><img src="'+t+'" alt="image-20230414000210957"></p><p>新建 <code>WIKI_TOKEN</code> ，并将第一步生成的 token 复制到此处。</p><blockquote><p>WIKI_TOKEN，名称随意，但要和后面 deploy.yml 中对应。</p></blockquote><img src="'+c+`" alt="image-20230414000304293" style="zoom:67%;"><h3 id="第三步-在项目中新建部署配置" tabindex="-1">第三步：在项目中新建部署配置 <a class="header-anchor" href="#第三步-在项目中新建部署配置" aria-label="Permalink to &quot;第三步：在项目中新建部署配置&quot;">​</a></h3><p>配置 <code>deploy.yml</code> (<code>.github\\workflows\\deploy.yml</code>) 。</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">push</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">jobs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">deploy</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">runs-on</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-latest</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">steps</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/checkout@v3</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">fetch-depth</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">actions/setup-node@v3</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">node-version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn install --frozen-lockfile</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Deploy</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">uses</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">peaceiris/actions-gh-pages@v3</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">github_token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.WIKI_TOKEN }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">publish_dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs/.vitepress/dist</span></span></code></pre></div><p>配置完成后 推送 <code>master</code> 分支代码到仓库。出现 gh-pages 分支，说明没问题。</p><p><img src="`+r+'" alt="image-20230414001428137"></p><h3 id="第四步-开启-git-pages" tabindex="-1">第四步：开启 git pages <a class="header-anchor" href="#第四步-开启-git-pages" aria-label="Permalink to &quot;第四步：开启 git pages&quot;">​</a></h3><blockquote><p>注意：私有项目需要付费才能开启</p></blockquote><p>步骤：<code>Settings -&gt; Pages -&gt; Branch 切换为 gh-pages</code></p><p><img src="'+i+'" alt="image-20230414001544545"></p><p>成功后通过 <a href="https://asplitline.github.io/wiki-template/" target="_blank" rel="noreferrer">https://asplitline.github.io/wiki-template/</a> 进行访问。</p><h3 id="第五步-配置域名" tabindex="-1">第五步：配置域名 <a class="header-anchor" href="#第五步-配置域名" aria-label="Permalink to &quot;第五步：配置域名&quot;">​</a></h3><blockquote><p>没有域名，这部可以略过。</p></blockquote><p>为了简化流程：申请域名申请，审核流程。</p><p>以腾讯云为例：<strong>我们需要添加两条记录：<code>TXT</code> 和 <code>CNAME</code></strong></p><p><code>域名注册 -&gt; 我的域名 -&gt; 找到对应域名（tk-292.xyz）进行解析操作</code></p><p><img src="'+y+'" alt="image-20230414003739497"></p><p><img src="'+D+'" alt="image-20230414002237284"></p><h4 id="添加-cname-记录值" tabindex="-1">添加 <code>CNAME</code> 记录值 <a class="header-anchor" href="#添加-cname-记录值" aria-label="Permalink to &quot;添加 `CNAME` 记录值&quot;">​</a></h4><p>主机记录：此处填的 <code>wiki</code>，是一个二级域名，也可填写 <code>www</code>。但无论填什么，都要与后续步骤对应上</p><p>记录类型：选择 <code>CNAME</code></p><p>记录值：为 github 用户名加上 github.io。如：我 github 用户名为 asplitline，所以填 <code>asplitline.github.io</code></p><h4 id="添加-txt-记录值" tabindex="-1">添加 <code>TXT</code> 记录值 <a class="header-anchor" href="#添加-txt-记录值" aria-label="Permalink to &quot;添加 `TXT` 记录值&quot;">​</a></h4><p>添加 <code>TXT</code> 记录值，首先需要获取 <code>TXT</code> 相关信息，请按照以下操作获取。</p><p><code>Settings -&gt; Pages -&gt; Add a domain</code></p><p><img src="'+C+'" alt="image-20230414002720730"></p><p><img src="'+F+'" alt="image-20230414003156164" style="zoom:80%;"><img src="'+A+'" alt="image-20230414003038880" style="zoom:80%;"></p><p>按上图进行操作后，将获得所需 主机记录 和 记录值</p><p>主机记录：<code>_github-pages-challenge-Asplitline.wiki</code></p><p>记录类型：选择 <code>TXT</code></p><p>记录值：<code>52f7c48b917557cb186908c2630dd8</code></p><p>验证通过后如下图</p><p><img src="'+d+'" alt="image-20230414003257179"></p><h4 id="添加域名解析" tabindex="-1">添加域名解析 <a class="header-anchor" href="#添加域名解析" aria-label="Permalink to &quot;添加域名解析&quot;">​</a></h4><p>回到项目下，将域名填入 <code>Custom domain</code></p><p><img src="'+h+`" alt="image-20230414003502085"></p><p>解析无错后，可以通过 <a href="https://wiki.tk-292.xyz/" target="_blank" rel="noreferrer">https://wiki.tk-292.xyz/</a> 进行访问。</p><blockquote><p>建议勾选 Enfore HTTPS 选项</p></blockquote><h4 id="域名丢失问题" tabindex="-1">域名丢失问题 <a class="header-anchor" href="#域名丢失问题" aria-label="Permalink to &quot;域名丢失问题&quot;">​</a></h4><p><code>custom domain</code> 值在每次部署会丢失，需要重新填写。</p><p>两种方法：添加 <code>CNAME</code> 文件 或者 <code>在 deploy.yml</code> 新增 <code>cname</code> 字段</p><p>方法一：添加 CNAME 文件：在 <code>public</code> 目录下(<code>docs/public/CNAME</code>)下添加 <code>CNAME</code> 文件，内容如下</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">wiki.tk-292.xyz</span></span></code></pre></div><p>方法二：<code>在 deploy.yml</code> 新增 <code>cname</code> 字段</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">with</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">github_token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">\${{ secrets.WIKI_TOKEN }}</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">publish_dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docs/.vitepress/dist</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">cname</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">wiki.tk-292.xyz</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># if wanna deploy to custom domain</span></span></code></pre></div><h2 id="vitepress-添加-algolia-search" tabindex="-1">vitepress 添加 algolia search <a class="header-anchor" href="#vitepress-添加-algolia-search" aria-label="Permalink to &quot;vitepress 添加 algolia search&quot;">​</a></h2><p><a href="https://docsearch.algolia.com/" target="_blank" rel="noreferrer">https://docsearch.algolia.com/</a></p>`,86),u=[g];function b(f,_,k,E,x,w){return n(),a("div",null,u)}const P=s(m,[["render",b]]);export{v as __pageData,P as default};
